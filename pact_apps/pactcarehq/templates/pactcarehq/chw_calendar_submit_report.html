{% extends base_template %}
{% load patient_lookup %}

{% block page_header %}
    <h2>CHW Submission Schedule for {{ username }}
        <small>{{ end_date|date:"m/d/Y" }} - {{ start_date|date:"m/d/Y" }}</small>
    </h2>
{% endblock %}

{% block page_crumbs %}
    <ul class="breadcrumb">
        <li><a href="/">Home</a> <span class="divider">/</span></li>
        <li class="active">CHW Submission Schedule</li>

    </ul>
{% endblock page_crumbs %}

{% block content %}
    <div class="row-fluid">
        <div class="span4">
            {% if total_scheduled == total_visited %}
                <div class="alert alert-success">
                    <strong>Scheduled Visits: </strong> {{ total_visited }} / {{ total_scheduled }}
                </div>
            {% else %}
                <div class="alert alert-error">
                    <strong>Scheduled Visits: </strong> {{ total_visited }} / {{ total_scheduled }}
                </div>
            {% endif %}
        </div>
        <div class="span8 pull-right" style="text-align:right;">
            <a href="{{ request.path }}?interval=1">Today</a> &nbsp;
            <a href="{{ request.path }}?interval={% now "w" %}">Week to date</a> &nbsp;
            <a href="{{ request.path }}?interval=7">7 days</a> &nbsp;
            <a href="{{ request.path }}?interval={% now "j" %}">Month to date</a> &nbsp;
            <a href="{{ request.path }}?interval=30">30 days</a>
            <br>
            <a href="{{ request.path }}?getcsv&interval=7">CSV 7</a>
            <a href="{{ request.path }}?getcsv&interval={% now "j" %}">CSV MTD</a>&nbsp;
            <a href="{{ request.path }}?getcsv&interval=30">CSV 30</a>
        </div>
    </div> <!-- end top row -->
    <div class="row-fluid">
        <div class="span2"><h3>Date</h3></div>
        <div class="span3"><h3>Patient Scheduled</h3></div>
        <div class="span7"><h3>Visits</h3></div>
    </div>

    {% for visit_date, patient_visits in date_arr %}
        {% if patient_visits %}
            {% for cpatient, visit in patient_visits %}
                <div class="row-fluid">
                    {% if forloop.counter0 == 0 %}
                        <div class="span2">
                            <h4>{{ visit_date|date:"D N j, Y" }}</h4>
                        </div>
                    {% else %}
                        <div class="span2">&nbsp;</div>
                    {% endif %}
                    <div class="span3">
                        <div class="alert alert-success">
                            <h4>
                                <a href="{% url view_pactpatient cpatient.get_id '' %}">{{ cpatient.first_name }} {{ cpatient.last_name }}
                                    ({{ cpatient.pact_id }})</a>
                            </h4>
                        </div>
                    </div>
                    <div class="span7">
                        {% if visit %}
                            <div class="alert alert-info">
                                <strong>
                                    <a href="{% patient_url_from_form visit %}">
                                        {% if visit.form.scheduled == "yes" %}
                                            Scheduled
                                        {% else %}
                                            Unscheduled
                                        {% endif %}
                                        ({{ visit.form.visit_type|title }})
                                    </a></strong>
                                by
                                {% if visit.form.Meta.username == username %}
                                    <strong>{{ visit.form.Meta.username }}</strong>
                                {% else %}
                                    <em>{{ visit.form.Meta.username }}</em>
                                {% endif %}
                                &nbsp;&nbsp;
                                <a href="{% url show_submission visit.get_id %}">View</a>
                            </div>
                        {% else %}
                            <div class="alert alert-error"><h4>No Visit</h4></div>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="row-fluid">
                <div class="span2">
                    <strong>{{ visit_date|date:"D N j, Y" }}</strong>
                </div>
                <div class="span3">
                    -- No Patients Scheduled --
                </div>
                <div class="span7">
                    <div class="span9" style="padding:.8em;margin-bottom:1em;border:2px solid #fff;">
                    </div>
                </div>
            </div>
        {% endif %}
    {% endfor %}
    </div>
{% endblock content %}
