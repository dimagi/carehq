{% extends base_template %}
{% load xform_tags %}
{% block extrahead %}
    <link rel="stylesheet" href="{{STATIC_URL}}couchforms/stylesheets/xforms.css" type="text/css">
    <script type="text/javascript" src="{{STATIC_URL}}carehq/js/djangocookie.js"></script>
    <script>
        function rm_dot(doc_id) {
            var answer = confirm("Are you sure you want to remove this DOT submission? This is an irreversible operation!");
            if (answer) {
                //call the url
                var remove_url = "{% url rm_pact_submission %}";
                var payload = {
                    'csrfmiddlewaretoken':getCookie("csrftoken"),
                    'doc_id':doc_id,
                };

                send_xhr = $.ajax({
                    "type":"POST",
                    "url":remove_url,
                    "data":payload,
                    "success":function (data, textStatus, jqXHR) {
                        console.log(data);
                        window.location = data;

                    },
                    "error":function (data) {
                        alert(data);
                        $('body').replaceWith(data.responseText);
                    }
                });
            }
        }
    </script>
{% endblock extrahead %}

{% block page_crumbs %}
{% endblock page_crumbs %}

{% block page_header %}
    <div class="row">
        <div class="span7">
            <h2>View {{ form_type }} Submission</h2>
        </div>
        <div class="span5 pull-right">
            {% if form_type == "Bloodwork" %}
                <a class="btn" href="{% url webxforms.views.edit_xform_interaction xform.get_id %}?override=full">
                    <i class="icon-edit"></i>
                    Edit
                </a>
            {% endif %}

            {% if form_type == "Progress Note" %}
                <a class="btn" href="{% url webxforms.views.edit_xform_interaction xform.get_id %}?override=full">
                    <i class="icon-edit"></i>
                    Edit
                </a>
            {% endif %}
            {% if form_type == "DOTS" %}
                <a class="btn"
                   href="{% url webxforms.views.edit_xform_interaction xform.get_id %}?override=full">
                    <i class="icon-edit"></i>
                    Edit
                </a> &nbsp;
                <a class="btn"
                   href="javascript:rm_dot('{{ xform.get_id }}')">
                    <i class="icon-trash"></i>
                    Delete
                </a>
            {% endif %}

        </div>
    </div>
{% endblock page_header %}

{% block content %}
    <div class="row">
        <div class="span12">{% render_form_data xform %}</div>
        {% if form_type == "DOTS" %}
        <div class="span12">
            <h4>Rendered DOTS</h4>

        </div>
        {% endif %}
    </div>

    <div class="row">
        <div class="span12 well">
            <h3>Supplemental Memos</h3>
            {% if comments %}
                {% for comment in comments %}
                    {{ comment.0.comment }} <br>
                    <div class="offset1">
                        <small>by {{ comment.0.created_by }}
                            on {{ comment.0.created|date }} {{ comment.0.created|time }}</small>
                    </div>
                    <hr>
                {% endfor %}
            {% endif %}
            {% if form %}
                <form method="POST" action="{{request.path}}">
                    {% csrf_token %}
                    {{ form.as_table }}
                    <input type="submit" value="Write Memo"/>
                    <input type="hidden" name="next" value="{{ request.path }}"/>
                </form>
            {% else %}
                <a href="{{ request.path }}?comment">Add Memo</a>
            {% endif %}
        </div>
    </div>
{% endblock content %}
