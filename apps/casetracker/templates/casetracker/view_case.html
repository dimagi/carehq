{% extends "base.html" %}
{% load i18n %}
{% block title %}{% trans "View Case" %}{% endblock %}
{% block extrahead %}
{% endblock %}
 
{% block content %}
<h2>{{case.description}}</h2>
<ul>
	<li>ID: {{case.id}}</li>
	<li>Opened by: <a href="{% url ashandapp.views.users.single  case.opened_by.id %}">{{case.opened_by}}</a></li>
	<li>Opened Date: {{case.opened_date}}</li>
	<li>Priority: {{case.priority}}</li>
	<li>Last edit date: {{case.last_edit_date}}</li>
	{% if case.last_edit_by %} {#this is a nasty hack, last eidt shoudn't be null#}
	<li>Last edit by: <a href="{% url ashandapp.views.users.single case.last_edit_by.id %}">{{case.last_edit_by}}</a></li>
	{% endif %}
	<li>Last event: {{case.last_case_event.activity}}</li>
	<li>Last event date: {{case.last_event_date}}</li>
	<li>Last event by: <a href="{% url ashandapp.views.users.single case.last_event_by.id %}">{{case.last_event_by}}</a></li>	
</ul>

(sort by <a href="{% url casetracker.views.view_case case.id %}?sort=person">person</a>, <a href="{% url casetracker.views.view_case case.id %}?sort=activity">activity</a>, <a href="{% url casetracker.views.view_case case.id %}?sort=category">category</a>, <a href="{% url casetracker.views.view_case case.id %}?sort=case">cases</a>, <a href="{% url casetracker.views.view_case case.id%}">none</a>)<br>
<h2>Newsfeed</h2> 
{% if not formatting %}
	{% for event in events %}
		<fieldset class="span-22">
		<a href="{% url ashandapp.views.users.single event.created_by.id %}">{{event.created_by.get_full_name}}</a> {{event.activity.phrasing}} this <a href="{% url casetracker.views.view_case event.case.id %}">{{event.activity.category}} {{event.case.id}}</a> <br>
		<i>{{event.notes}}</i><br>
		{{event.created_date|date}} {{event.created_date|time}}
		</fieldset>
	{% endfor %}
{% else %}
	{% for key, value in events.items %}
		<fieldset class="span-22">
		<h3>{{key}}</h3>
		{% for event in value%}
			<a href="{% url ashandapp.views.users.single event.created_by.id %}">{{event.created_by.get_full_name}}</a> {{event.activity.phrasing}} this <a href="{% url casetracker.views.view_case event.case.id %}">{{event.activity.category}} {{event.case.id}}</a> <br>
			<i>{{event.notes}}</i><br>
			{{event.created_date|date}} {{event.created_date|time}}<br><br>
		{% endfor %}
		</fieldset>
	{% endfor %}
{% endif %}
{% endblock %}
