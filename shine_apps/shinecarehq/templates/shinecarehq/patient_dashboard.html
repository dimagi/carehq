{% extends base_template %}
{% load i18n %}
{% load patient_tags %}
{% load shineforms_tags %}

{% block extrahead %}
    <script type="text/javascript" src="{{STATIC_URL}}carehq/tablesorter/jquery.tablesorter.min.js"></script>
    <link rel="stylesheet" href="{{ STATIC_URL }}carehq/tablesorter/blue/style.css" type="text/css" media="print, projection, screen"/>
    <script type="text/javascript" charset="utf-8">
        $().ready(function () {
            $("#patient-table").tablesorter({sortList:[
                [0, 0]
            ], widgets:['zebra']});
        });
    </script>
    <link rel="stylesheet" href="{{STATIC_URL}}shinecarehq/shinecarehq.css" type="text/css">
{% endblock %}

{% block page_header %}
    <h1>Bacteremia Dashboard
        <small>{{ show_string }}</small>
    </h1>
{% endblock %}

{% block page_crumbs %}
    <ul class="breadcrumb">
        <li class="active"><a href="/">Home</a> <span class="divider">/</span></li>
    </ul>
{% endblock page_crumbs %}
{% block content %}

    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span2">
                <!--Sidebar content-->
                <h3>Dashboard Views</h3>
                <ul class="nav nav-pills nav-stacked">
                    <li class="{% if active_pill == "all" %}active{% endif %}"><a href="{{ request.path }}?show=all">All Patients ({{ patients|length }})</a></li>
                    <li class="{% if active_pill == "active" %}active{% endif %}"><a href="{{ request.path }}?show=active">Active ({{ active|length }})</a></li>
                    <li class="{% if active_pill == "inactive" %}active{% endif %}"><a href="{{ request.path }}?show=inactive">Inactive ({{ inactive|length }})</a></li>
                    <li class="{% if active_pill == "enrolled_today" %}active{% endif %}"><a href="{{ request.path }}?show=enrolled_today">Enrolled Today
                        ({{ enrolled_today|length }})</a></li>
                    <li class="{% if active_pill == "positive" %}active{% endif %}"><a href="{{ request.path }}?show=positive">Positive ({{ positive|length }})</a></li>
                    <li class="{% if active_pill == "negative" %}active{% endif %}"><a href="{{ request.path }}?show=negative">Negative ({{ negative|length }})</a></li>
                    <li class="{% if active_pill == "contaminated" %}active{% endif %}"><a href="{{ request.path }}?show=contaminated">Contaminated ({{ contaminated|length }})</a></li>
                    <li class="{% if active_pill == "needing_fup" %}active{% endif %}"><a href="{{ request.path }}?show=needing_fup">Needing Follow Up ({{ only_enrolled|length }})</a>
                    </li>
                </ul>
            </div>
            <div class="span10">
                <!--Body content-->
                <table id="patient-table" class="table table-striped tablesorter">
                    <thead>
                    <tr>
                        <th>{% trans "Surname" %}</th>
                        <th>{% trans "Given Name" %}</th>
                        <th>{% trans "Sex" %}</th>
                        <th>{% trans "Age" %}</th>
                        <th>{% trans "Location" %}</th>
                        <th>{% trans "Enrolled" %}</th>
                        <th>{% trans "Last Action" %}</th>
                        <th>{% trans "Last Date" %}</th>
                        <th>{% trans "Current Status" %}</th>
                    </tr>
                    </thead>

                    <tbody>
                    {% for patient_tuple in show_list %}
                        <tr>

                            <td>
                                {% if patient_tuple.0.last_name %}
                                    <a href="{% url shine_single_patient patient_tuple.0.get_id '' %}">{{ patient_tuple.0.last_name|title }}</a>
                                {% else %}
                                    wtf
                                {% endif %}
                            </td>
                            <td>
                                {% if patient_tuple.0.first_name %}
                                    <a href="{% url shine_single_patient patient_tuple.0.get_id '' %}">{{ patient_tuple.0.first_name|title }}</a>
                                {% endif %}
                            </td>
                            <td>
                                {{ patient_tuple.0.gender|slice:":1"|title }}
                            </td>
                            <td>
                                {{ patient_tuple.0.age_int }}
                            </td>
                            <td>
                                Ward {{ patient_tuple.1.ward }} Bed {{ patient_tuple.1.bed }}
                            </td>
                            <td>{{ patient_tuple.1.enrollment_date|date:"Y-m-d" }}</td>


                            <td>
                                {{ patient_tuple.1.last_encounter }}
                            </td>
                            <td>
                                {{ patient_tuple.1.last_encounter_date|date:"Y-m-d" }}
                            </td>
                            <td class="mepi_status_matrix">
                                {% get_status_matrix patient_tuple %}
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
{% endblock content %}
