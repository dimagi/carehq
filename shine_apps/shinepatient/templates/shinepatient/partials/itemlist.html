{% load patient_tags %}
<table>
<thead>
    <tr>
        <th>Name</th><th>Date</th><th>Barcode</th>{% if not patient %}<th>Patient</th>{% endif %}<th>Status</th>
    </tr>
</thead>
<tbody>
{% for case in cases %}
<tr>    
    <td><a href="{% url shine_case_details case.get_id %}">{{ case.name }}</a></td>
    <td>{{ case.opened_on }}</td>
    <td>
        {% if case.barcode %}
        <div id="qrcode-{{ case.get_id }}"></div>
        <script type="text/javascript">
            function updateQRCode(text) {
            var element = document.getElementById("qrcode-{{ case.get_id }}");
            var bodyElement = document.body;
            if(element.lastChild)
              element.replaceChild(showQRCode(text), element.lastChild);
            else
              element.appendChild(showQRCode(text));
          }
            updateQRCode("{{ case.barcode }}");
        </script>
        <small>{{ case.barcode }}</small>
        {% else %}
            No Barcode Set
        {% endif %}
{% if not patient %}<td>{% if case.patient_name %}<a href="{% patient_url case.patient_guid %}">{{ case.patient_name }}</a>{% else %}NO LINKED PATIENT{% endif %}</td>{% endif %}
    <td>{{ case.closed|yesno:"closed,open"}}</td>
</tr>
{% endfor %}
</tbody>
</table>